<!DOCTYPE html>
<html lang="ka">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>áƒáƒ áƒáƒ¤áƒ˜áƒšáƒ˜ - OLD MAFIA</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { background: #050505; color: white; font-family: sans-serif; text-align: center; padding: 20px; }
        .avatar { width: 130px; height: 130px; border-radius: 50%; border: 3px solid #ff4500; object-fit: cover; margin: 20px auto; display: block; background: #111; }
        .nick-title { color: #ffd700; font-size: 24px; margin-bottom: 10px; }
        .status-box { background: #111; padding: 15px; border-radius: 12px; margin: 20px 0; border: 1px solid #222; min-height: 50px; color: #ccc; }
        .btn { background: #ff4500; color: white; border: none; padding: 12px 20px; border-radius: 8px; cursor: pointer; margin: 5px; font-weight: bold; }
        .back { display: block; margin-top: 30px; color: #ff4500; text-decoration: none; font-weight: bold; }
        input[type="file"] { background: #111; padding: 10px; border-radius: 8px; margin-bottom: 10px; width: 80%; }
        #edit-area { display: none; background: #0a0a0a; padding: 20px; border-radius: 15px; border: 1px solid #222; }
    </style>
</head>
<body>
    <div id="profile-view">
        <h2 id="user-nick" class="nick-title">áƒ˜áƒ¢áƒ•áƒ˜áƒ áƒ—áƒ”áƒ‘áƒ...</h2>
        <img id="view-avatar" class="avatar" src="https://via.placeholder.com/130">
        <div id="user-status" class="status-box">áƒ˜áƒ¢áƒ•áƒ˜áƒ áƒ—áƒ”áƒ‘áƒ áƒ¡áƒ¢áƒáƒ¢áƒ£áƒ¡áƒ˜...</div>
        
        <div id="own-controls" style="display:none;">
            <button class="btn" onclick="showEdit()">ğŸ› ï¸ áƒáƒ áƒáƒ¤áƒ˜áƒšáƒ˜áƒ¡ áƒ¨áƒ”áƒªáƒ•áƒšáƒ</button>
        </div>
    </div>

    <div id="edit-area">
        <h3 style="color: #ff4500;">áƒ áƒ”áƒ“áƒáƒ¥áƒ¢áƒ˜áƒ áƒ”áƒ‘áƒ</h3>
        <p style="font-size: 12px; color: #666; margin-bottom: 10px;">áƒáƒ˜áƒ áƒ©áƒ˜áƒ” áƒáƒ®áƒáƒšáƒ˜ áƒ¤áƒáƒ¢áƒ:</p>
        <input type="file" id="file-input" accept="image/*"><br>
        <textarea id="status-input" style="width:90%; height:80px; background:#111; color:white; border:1px solid #333; padding:10px; border-radius:8px;" placeholder="áƒ“áƒáƒ¬áƒ”áƒ áƒ” áƒ áƒáƒ›áƒ” áƒ¨áƒ”áƒœáƒ¡ áƒ¨áƒ”áƒ¡áƒáƒ®áƒ”áƒ‘..."></textarea><br><br>
        <button class="btn" onclick="saveProfile()">ğŸ’¾ áƒ¨áƒ”áƒœáƒáƒ®áƒ•áƒ</button>
        <button class="btn" style="background:#444;" onclick="location.reload()">ğŸ”™ áƒ’áƒáƒ£áƒ¥áƒ›áƒ”áƒ‘áƒ</button>
    </div>

    <a href="home.html" class="back" onclick="localStorage.removeItem('view_profile_of')">ğŸ”™ áƒ£áƒ™áƒáƒœ áƒ©áƒáƒ¢áƒ¨áƒ˜</a>

    <script>
        const _sb = supabase.createClient("https://ftfciebnywbondaiarnc.supabase.co", "sb_publishable_eQZDSu_Jy1gWmXJFF800Pw_TP2kBRLI");
        const myNick = localStorage.getItem('username');
        // áƒ•áƒáƒ›áƒáƒ¬áƒ›áƒ”áƒ‘áƒ— áƒ¡áƒ®áƒ•áƒ˜áƒ¡ áƒáƒ áƒáƒ¤áƒ˜áƒšáƒ¡ áƒ•áƒ£áƒ§áƒ£áƒ áƒ”áƒ‘áƒ— áƒ—áƒ£ áƒ©áƒ•áƒ”áƒœáƒ¡áƒáƒ¡
        let targetNick = localStorage.getItem('view_profile_of') || myNick;

        async function loadProfile() {
            document.getElementById('user-nick').innerText = `ğŸ‘¤ ${targetNick}`;
            
            // áƒ—áƒ£ áƒ©áƒ”áƒ›áƒ¡ áƒáƒ áƒáƒ¤áƒ˜áƒšáƒ–áƒ” áƒ•áƒáƒ , áƒ’áƒáƒ›áƒáƒáƒ©áƒ˜áƒœáƒ” "áƒ¨áƒ”áƒªáƒ•áƒšáƒ˜áƒ¡" áƒ¦áƒ˜áƒšáƒáƒ™áƒ˜
            if(targetNick === myNick) {
                document.getElementById('own-controls').style.display = 'block';
            }

            const { data, error } = await _sb.from('profiles').select('*').eq('nickname', targetNick).single();
            
            if(data) {
                if(data.avatar_url) document.getElementById('view-avatar').src = data.avatar_url;
                document.getElementById('user-status').innerText = data.status || "áƒ¡áƒ¢áƒáƒ¢áƒ£áƒ¡áƒ˜ áƒáƒ  áƒáƒ áƒ˜áƒ¡ áƒ›áƒ˜áƒ—áƒ˜áƒ—áƒ”áƒ‘áƒ£áƒšáƒ˜";
                document.getElementById('status-input').value = data.status || "";
            } else {
                document.getElementById('user-status').innerText = "áƒ›áƒáƒ›áƒ®áƒ›áƒáƒ áƒ”áƒ‘áƒ”áƒšáƒ¡ áƒ¯áƒ”áƒ  áƒáƒ  áƒáƒ¥áƒ•áƒ¡ áƒáƒ áƒáƒ¤áƒ˜áƒšáƒ˜ áƒ¨áƒ”áƒ•áƒ¡áƒ”áƒ‘áƒ£áƒšáƒ˜.";
            }
        }

        function showEdit() {
            document.getElementById('profile-view').style.display = 'none';
            document.getElementById('edit-area').style.display = 'block';
        }

        async function saveProfile() {
            const file = document.getElementById('file-input').files[0];
            const status = document.getElementById('status-input').value;
            let url = document.getElementById('view-avatar').src;

            if(file) {
                const name = `${myNick}_avatar.png`;
                const { data, error } = await _sb.storage.from('avatars').upload(name, file, { upsert: true });
                url = `https://ftfciebnywbondaiarnc.supabase.co/storage/v1/object/public/avatars/${name}?t=${Date.now()}`;
            }

            const { error: upsertError } = await _sb.from('profiles').upsert({ 
                nickname: myNick, 
                avatar_url: url, 
                status: status 
            });

            if(!upsertError) {
                alert("áƒáƒ áƒáƒ¤áƒ˜áƒšáƒ˜ áƒ¬áƒáƒ áƒ›áƒáƒ¢áƒ”áƒ‘áƒ˜áƒ— áƒ’áƒáƒœáƒáƒ®áƒšáƒ“áƒ! ğŸš€");
                location.reload();
            } else {
                alert("áƒ¨áƒ”áƒªáƒ“áƒáƒ›áƒ áƒ¨áƒ”áƒœáƒáƒ®áƒ•áƒ˜áƒ¡áƒáƒ¡!");
            }
        }

        loadProfile();
    </script>
</body>
</html>
