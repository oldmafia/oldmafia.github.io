<!DOCTYPE html>
<html lang="ka">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>áƒáƒ áƒáƒ¤áƒ˜áƒšáƒ˜ - OLD MAFIA</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { background: #050505; color: white; font-family: sans-serif; text-align: center; padding: 20px; }
        .avatar { width: 120px; height: 120px; border-radius: 50%; border: 3px solid #ff4500; object-fit: cover; margin-bottom: 20px; }
        input, textarea { width: 90%; padding: 12px; margin: 10px 0; background: #111; border: 1px solid #333; color: white; border-radius: 8px; }
        .save-btn { background: #ff4500; color: white; border: none; padding: 12px 30px; border-radius: 8px; cursor: pointer; font-weight: bold; }
        .back { display: block; margin-top: 20px; color: #aaa; text-decoration: none; }
    </style>
</head>
<body>
    <h2>ğŸ‘¤ áƒ©áƒ”áƒ›áƒ˜ áƒáƒ áƒáƒ¤áƒ˜áƒšáƒ˜</h2>
    <img id="view-avatar" class="avatar" src="https://via.placeholder.com/120">
    <br>
    <input type="file" id="file-input" accept="image/*" onchange="uploadAvatar()">
    <textarea id="status-input" placeholder="áƒ“áƒáƒ¬áƒ”áƒ áƒ” áƒ¨áƒ”áƒœáƒ˜ áƒ¡áƒ¢áƒáƒ¢áƒ£áƒ¡áƒ˜..."></textarea>
    <button class="save-btn" onclick="saveProfile()">áƒ¨áƒ”áƒœáƒáƒ®áƒ•áƒ</button>
    <a href="home.html" class="back">â¬… áƒ£áƒ™áƒáƒœ áƒ©áƒáƒ¢áƒ¨áƒ˜</a>

    <script>
        const _sb = supabase.createClient("https://ftfciebnywbondaiarnc.supabase.co", "sb_publishable_eQZDSu_Jy1gWmXJFF800Pw_TP2kBRLI");
        const myNick = localStorage.getItem('username');

        async function loadProfile() {
            const { data } = await _sb.from('profiles').select('*').eq('nickname', myNick).single();
            if(data) {
                if(data.avatar_url) document.getElementById('view-avatar').src = data.avatar_url;
                document.getElementById('status-input').value = data.status || "";
            }
        }

        async function uploadAvatar() {
            const file = document.getElementById('file-input').files[0];
            const fileName = `${myNick}_${Date.now()}.png`;
            await _sb.storage.from('avatars').upload(fileName, file);
            const url = `https://ftfciebnywbondaiarnc.supabase.co/storage/v1/object/public/avatars/${fileName}`;
            document.getElementById('view-avatar').src = url;
            await _sb.from('profiles').upsert({ nickname: myNick, avatar_url: url });
        }

        async function saveProfile() {
            const status = document.getElementById('status-input').value;
            await _sb.from('profiles').upsert({ nickname: myNick, status: status });
            alert("áƒáƒ áƒáƒ¤áƒ˜áƒšáƒ˜ áƒ’áƒáƒœáƒáƒ®áƒšáƒ“áƒ!");
        }
        loadProfile();
    </script>
</body>
</html>
