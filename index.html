<!DOCTYPE html>
<html lang="ka">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>áƒ™áƒáƒ˜áƒ¤áƒ›áƒáƒœáƒ˜áƒ</title>

<script src="https://unpkg.com/@supabase/supabase-js@2"></script>

<style>
body{
margin:0;
height:100vh;
display:flex;
justify-content:center;
align-items:center;
background:radial-gradient(circle,#330000 0%,#000 70%);
font-family:Arial;
}

.card-wrapper{
position:relative;
width:350px;
}

.card-wrapper::before{
content:"";
position:absolute;
inset:0;
background:red;
border-radius:30px;
transform:rotate(-4deg);
box-shadow:0 0 80px red;
z-index:0;
}

.card{
position:relative;
background:#0d0d0d;
padding:40px 25px;
border-radius:30px;
transform:rotate(-2deg);
z-index:1;
text-align:center;
}

h1{
color:white;
text-shadow:0 0 20px red;
margin-bottom:25px;
}

input{
width:100%;
padding:12px;
margin-bottom:15px;
border-radius:12px;
border:none;
background:#1a1a1a;
color:white;
outline: none;
}

button{
width:100%;
padding:14px;
border:none;
border-radius:20px;
background:red;
color:white;
font-weight:bold;
margin-bottom:12px;
cursor:pointer;
font-size:16px;
transition: 0.3s;
}

button:hover{
background:darkred;
box-shadow: 0 0 15px red;
}

.hidden{
display:none;
}

#message{
color:white;
margin-top:10px;
min-height:20px;
font-size: 13px;
}
</style>
</head>
<body>

<div class="card-wrapper">
<div class="card">

<h1>áƒ™áƒáƒ˜áƒ¤áƒ›áƒáƒœáƒ˜áƒ ğŸ˜ğŸ”¥</h1>

<div id="mainButtons">
<button id="regBtn">áƒ áƒ”áƒ’áƒ˜áƒ¡áƒ¢áƒ áƒáƒªáƒ˜áƒ</button>
<button id="logBtn">áƒ¨áƒ”áƒ¡áƒ•áƒšáƒ</button>
</div>

<div id="formSection" class="hidden">
<input type="text" id="nickname" placeholder="áƒœáƒ˜áƒ™áƒœáƒ”áƒ˜áƒ›áƒ˜">
<input type="email" id="email" placeholder="áƒ”áƒšáƒ¤áƒáƒ¡áƒ¢áƒ">
<input type="password" id="password" placeholder="áƒáƒáƒ áƒáƒšáƒ˜">
<button id="submitBtn"></button>
<button onclick="location.reload()" style="background:transparent; font-size:12px; color:#555;">áƒ£áƒ™áƒáƒœ áƒ“áƒáƒ‘áƒ áƒ£áƒœáƒ”áƒ‘áƒ</button>
</div>

<p id="message"></p>

</div>
</div>

<script>
// Supabase-áƒ˜áƒ¡ áƒ“áƒáƒ™áƒáƒ•áƒ¨áƒ˜áƒ áƒ”áƒ‘áƒ
const { createClient } = supabase;
const supabaseClient = createClient(
  "https://ftfciebnywbondaiarnc.supabase.co",
  "sb_publishable_eQZDSu_Jy1gWmXJFF800Pw_TP2kBRLI"
);

const mainButtons = document.getElementById("mainButtons");
const formSection = document.getElementById("formSection");
const nicknameInput = document.getElementById("nickname");
const submitBtn = document.getElementById("submitBtn");
const message = document.getElementById("message");

document.getElementById("regBtn").addEventListener("click", () => {
  mainButtons.classList.add("hidden");
  formSection.classList.remove("hidden");
  nicknameInput.style.display = "block";
  submitBtn.innerText = "áƒ áƒ”áƒ’áƒ˜áƒ¡áƒ¢áƒ áƒáƒªáƒ˜áƒ";
  submitBtn.onclick = register;
});

document.getElementById("logBtn").addEventListener("click", () => {
  mainButtons.classList.add("hidden");
  formSection.classList.remove("hidden");
  nicknameInput.style.display = "none";
  submitBtn.innerText = "áƒ¨áƒ”áƒ¡áƒ•áƒšáƒ";
  submitBtn.onclick = login;
});

// áƒ áƒ”áƒ’áƒ˜áƒ¡áƒ¢áƒ áƒáƒªáƒ˜áƒ˜áƒ¡ áƒ¤áƒ£áƒœáƒ¥áƒªáƒ˜áƒ
async function register(){
  const nickname = nicknameInput.value.trim();
  const email = document.getElementById("email").value.trim();
  const password = document.getElementById("password").value.trim();

  if(!nickname || !email || !password){
    message.innerText = "âš ï¸ áƒ¨áƒ”áƒáƒ•áƒ¡áƒ” áƒ§áƒ•áƒ”áƒšáƒ áƒ•áƒ”áƒšáƒ˜";
    return;
  }

  message.innerText = "áƒ›áƒ˜áƒ›áƒ“áƒ˜áƒœáƒáƒ áƒ”áƒáƒ‘áƒ¡ áƒ áƒ”áƒ’áƒ˜áƒ¡áƒ¢áƒ áƒáƒªáƒ˜áƒ...";

  const { data, error } = await supabaseClient.auth.signUp({
    email: email,
    password: password,
    options: {
      data: { nickname: nickname }
    }
  });

  if(error){
    message.innerText = "âŒ " + error.message;
    return;
  }

  // áƒáƒ˜ áƒáƒ¥ áƒ˜áƒœáƒáƒ®áƒ”áƒ‘áƒ áƒœáƒ˜áƒ™áƒ˜ áƒ‘áƒ áƒáƒ£áƒ–áƒ”áƒ áƒ¨áƒ˜!
  localStorage.setItem('username', nickname);
  
  message.style.color = "#00ff00";
  message.innerText = "âœ… áƒ¬áƒáƒ áƒ›áƒáƒ¢áƒ”áƒ‘áƒ˜áƒ— áƒ“áƒáƒ áƒ”áƒ’áƒ˜áƒ¡áƒ¢áƒ áƒ˜áƒ áƒ“áƒ˜!";
  
  setTimeout(() => { window.location.href = "home.html"; }, 1000);
}

// áƒ¨áƒ”áƒ¡áƒ•áƒšáƒ˜áƒ¡ áƒ¤áƒ£áƒœáƒ¥áƒªáƒ˜áƒ
async function login(){
  const email = document.getElementById("email").value.trim();
  const password = document.getElementById("password").value.trim();

  if(!email || !password){
    message.innerText = "âš ï¸ áƒ¨áƒ”áƒ˜áƒ§áƒ•áƒáƒœáƒ” áƒ›áƒ”áƒ˜áƒšáƒ˜ áƒ“áƒ áƒáƒáƒ áƒáƒšáƒ˜";
    return;
  }

  message.innerText = "áƒ›áƒáƒ¬áƒ›áƒ“áƒ”áƒ‘áƒ áƒ›áƒáƒœáƒáƒªáƒ”áƒ›áƒ”áƒ‘áƒ˜...";

  const { data, error } = await supabaseClient.auth.signInWithPassword({
    email: email,
    password: password
  });

  if(error){
    message.innerText = "âŒ " + error.message;
    return;
  }

  // Supabase-áƒ“áƒáƒœ áƒ•áƒ˜áƒ¦áƒ”áƒ‘áƒ— áƒ áƒ”áƒ’áƒ˜áƒ¡áƒ¢áƒ áƒáƒªáƒ˜áƒ˜áƒ¡áƒáƒ¡ áƒ›áƒ˜áƒ—áƒ˜áƒ—áƒ”áƒ‘áƒ£áƒš áƒœáƒ˜áƒ™áƒ¡
  const userNickname = data.user.user_metadata.nickname;
  
  // áƒ•áƒ˜áƒœáƒáƒ®áƒáƒ•áƒ— áƒœáƒ˜áƒ™áƒ¡ áƒ¢áƒ”áƒšáƒ”áƒ¤áƒáƒœáƒ¨áƒ˜
  localStorage.setItem('username', userNickname);

  message.style.color = "#00ff00";
  message.innerText = "âœ… áƒ›áƒáƒ’áƒ”áƒ¡áƒáƒšáƒ›áƒ”áƒ‘áƒ˜áƒ—, " + userNickname + "!";
  
  setTimeout(() => { window.location.href = "home.html"; }, 1000);
}
</script>

</body>
</html>
