<!DOCTYPE html>
<html lang="ka">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>OLD MAFIA</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
body{
  background:#000;
  color:white;
  font-family:sans-serif;
  margin:0;
  padding:20px;
}

h1{ color:orange; }

.top-links{
  margin-bottom:20px;
}

.top-links a{
  color:white;
  text-decoration:none;
  margin-right:15px;
}

.msg{
  margin:8px 0;
}

.nickname{
  color:gold;
  font-weight:bold;
  text-decoration:none;
}

input{
  padding:10px;
  margin:5px 0;
  width:100%;
  border-radius:6px;
  border:none;
}

button{
  padding:10px;
  width:100%;
  background:orange;
  border:none;
  border-radius:6px;
  margin-top:5px;
}
</style>
</head>
<body>

<h1>ğŸ’¬ OLD MAFIA áƒ©áƒáƒ¢áƒ˜</h1>

<div class="top-links">
  <a href="inbox.html">ğŸ“© Inbox</a>
</div>

<div id="chat"></div>

<input id="nicknameInput" placeholder="áƒœáƒ˜áƒ™áƒ˜">
<input id="messageInput" placeholder="áƒ›áƒ”áƒ¡áƒ˜áƒ¯áƒ˜">
<button onclick="sendMessage()">áƒ’áƒáƒ’áƒ–áƒáƒ•áƒœáƒ</button>

<script>
const supabase = window.supabase.createClient(
  "https://ftfciebnywbondaiarnc.supabase.co",
  "sb_publishable_eQZDSu_Jy1gWmXJFF800Pw_TP2kBRLI"
);

const chat = document.getElementById("chat");

async function loadMessages(){
  const { data } = await supabase
    .from("messages_v3")
    .select("*")
    .order("created_at",{ascending:true});

  chat.innerHTML="";

  if(!data) return;

  data.forEach(msg=>{
    chat.innerHTML += `
      <div class="msg">
        <a class="nickname" href="profile.html?user=${encodeURIComponent(msg.nickname)}">
          ${msg.nickname}
        </a>: ${msg.message}
      </div>
    `;
  });
}

async function sendMessage(){
  const nickname=document.getElementById("nicknameInput").value;
  const message=document.getElementById("messageInput").value;

  if(!nickname||!message) return;

  await supabase.from("messages_v3").insert([{nickname,message}]);

  document.getElementById("messageInput").value="";
  loadMessages();
}

loadMessages();
</script>

</body>
</html>
