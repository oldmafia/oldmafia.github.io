<!DOCTYPE html>
<html lang="ka">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ADMIN PANEL - OLD MAFIA</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { background: #000; color: white; font-family: sans-serif; padding: 20px; }
        header { display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #ff4500; padding-bottom: 10px; margin-bottom: 20px; }
        .back { color: #ff4500; text-decoration: none; font-weight: bold; }
        
        .card { background: #111; padding: 15px; border-radius: 10px; margin-bottom: 20px; border: 1px solid #222; }
        h2 { color: #ff4500; font-size: 18px; margin-bottom: 15px; }
        
        table { width: 100%; border-collapse: collapse; font-size: 13px; }
        th { text-align: left; color: #888; padding: 10px; border-bottom: 1px solid #222; }
        td { padding: 10px; border-bottom: 1px solid #111; }
        
        .del-btn { background: #ff4500; color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; }
        .del-btn:hover { background: #cc3700; }
        
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .stat-item { background: #1a1a1a; padding: 15px; border-radius: 10px; text-align: center; }
        .stat-num { display: block; font-size: 20px; font-weight: bold; color: #ff4500; }
    </style>
</head>
<body>

    <header>
        <a href="home.html" class="back">â¬… áƒ©áƒáƒ¢áƒ¨áƒ˜ áƒ“áƒáƒ‘áƒ áƒ£áƒœáƒ”áƒ‘áƒ</a>
        <span>ğŸ›¡ï¸ ADMIN PANEL (Buba)</span>
    </header>

    <div class="stats-grid">
        <div class="stat-item"><span id="total-msgs" class="stat-num">0</span>áƒ›áƒ”áƒ¡áƒ˜áƒ¯áƒ˜</div>
        <div class="stat-item"><span id="total-users" class="stat-num">0</span>áƒ˜áƒ£áƒ–áƒ”áƒ áƒ˜</div>
    </div>

    <div class="card" style="margin-top:20px;">
        <h2>áƒ‘áƒáƒšáƒ 15 áƒ›áƒ”áƒ¡áƒ˜áƒ¯áƒ˜ (áƒ¬áƒáƒ¨áƒšáƒ)</h2>
        <table id="msg-table">
            <thead>
                <tr>
                    <th>áƒáƒ•áƒ¢áƒáƒ áƒ˜</th>
                    <th>áƒ¢áƒ”áƒ¥áƒ¡áƒ¢áƒ˜</th>
                    <th>áƒ›áƒáƒ¥áƒ›áƒ”áƒ“áƒ”áƒ‘áƒ</th>
                </tr>
            </thead>
            <tbody>
                </tbody>
        </table>
    </div>

<script>
    const _sb = supabase.createClient("https://ftfciebnywbondaiarnc.supabase.co", "sb_publishable_eQZDSu_Jy1gWmXJFF800Pw_TP2kBRLI");

    // áƒ£áƒ¡áƒáƒ¤áƒ áƒ—áƒ®áƒáƒ”áƒ‘áƒ: áƒ—áƒ£ áƒœáƒ˜áƒ™áƒ˜ áƒáƒ  áƒáƒ áƒ˜áƒ¡ Buba, áƒ’áƒáƒáƒ’áƒ“áƒ” áƒ¡áƒáƒ˜áƒ¢áƒ˜áƒ“áƒáƒœ
    if (localStorage.getItem('username') !== "Buba") {
        alert("áƒ¨áƒ”áƒœ áƒáƒ  áƒ’áƒáƒ¥áƒ•áƒ¡ áƒáƒ¥ áƒ¨áƒ”áƒ›áƒáƒ¡áƒ•áƒšáƒ˜áƒ¡ áƒ£áƒ¤áƒšáƒ”áƒ‘áƒ!");
        location.href = 'home.html';
    }

    async function loadAdminData() {
        // 1. áƒ›áƒ”áƒ¡áƒ˜áƒ¯áƒ”áƒ‘áƒ˜áƒ¡ áƒ áƒáƒáƒ“áƒ”áƒœáƒáƒ‘áƒ
        const { count: mCount } = await _sb.from('messages_v3').select('*', { count: 'exact', head: true });
        document.getElementById('total-msgs').innerText = mCount || 0;

        // 2. áƒ˜áƒ£áƒ–áƒ”áƒ áƒ”áƒ‘áƒ˜áƒ¡ áƒ áƒáƒáƒ“áƒ”áƒœáƒáƒ‘áƒ
        const { count: uCount } = await _sb.from('avatars_v3').select('*', { count: 'exact', head: true });
        document.getElementById('total-users').innerText = uCount || 0;

        // 3. áƒ›áƒ”áƒ¡áƒ˜áƒ¯áƒ”áƒ‘áƒ˜áƒ¡ áƒ¡áƒ˜áƒ áƒ¬áƒáƒ¡áƒáƒ¨áƒšáƒ”áƒšáƒáƒ“
        const { data: msgs } = await _sb.from('messages_v3').select('*').order('created_at', { ascending: false }).limit(15);
        
        const tbody = document.querySelector('#msg-table tbody');
        tbody.innerHTML = msgs.map(m => `
            <tr>
                <td style="color:#ff4500; font-weight:bold;">${m.nickname}</td>
                <td>${m.message.substring(0, 30)}${m.message.length > 30 ? '...' : ''}</td>
                <td><button class="del-btn" onclick="deleteMsg(${m.id})">áƒ¬áƒáƒ¨áƒšáƒ</button></td>
            </tr>
        `).join('');
    }

    async function deleteMsg(id) {
        if (!confirm("áƒœáƒáƒ›áƒ“áƒ•áƒ˜áƒšáƒáƒ“ áƒ’áƒ¡áƒ£áƒ áƒ¡ áƒáƒ› áƒ›áƒ”áƒ¡áƒ˜áƒ¯áƒ˜áƒ¡ áƒ¬áƒáƒ¨áƒšáƒ?")) return;
        
        const { error } = await _sb.from('messages_v3').delete().eq('id', id);
        if (error) alert("áƒ•áƒ”áƒ  áƒ¬áƒáƒ˜áƒ¨áƒáƒšáƒ!");
        else loadAdminData();
    }

    // áƒ©áƒáƒ¢áƒ•áƒ˜áƒ áƒ—áƒ•áƒ
    loadAdminData();
</script>
</body>
</html>
