<!DOCTYPE html>
<html lang="ka">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>OLD MAFIA</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
:root{--red:#ff4500;--bg:#050505;--gray:#111;--gold:#ffd700;}
*{margin:0;padding:0;box-sizing:border-box;font-family:sans-serif;}
body{background:var(--bg);color:white;height:100vh;display:flex;flex-direction:column;overflow:hidden;}

header{
height:60px;background:#000;border-bottom:1px solid #222;
display:flex;align-items:center;padding:0 15px;
}

.burger{font-size:26px;color:var(--red);cursor:pointer;}
.room-name{flex:1;text-align:center;font-weight:bold;}

#top-avatar{
width:36px;height:36px;border-radius:50%;
object-fit:cover;cursor:pointer;border:2px solid #ff4500;
}

.sidebar{
position:fixed;left:-100%;top:0;width:85%;max-width:300px;
height:100%;background:#000;border-right:1px solid #222;
transition:0.3s;padding:20px;overflow-y:auto;z-index:1000;
}
.sidebar.open{left:0;}

.overlay{
display:none;position:fixed;inset:0;
background:rgba(0,0,0,0.8);z-index:900;
}

.room-btn{
padding:14px;margin-bottom:8px;cursor:pointer;
border-radius:12px;background:var(--gray);color:#aaa;
}
.room-btn.active{background:var(--red);color:white;}

#messages{
flex:1;padding:15px;overflow-y:auto;
display:flex;flex-direction:column;gap:10px;
}

.bubble{
background:#161616;padding:10px;border-radius:15px;
border-left:4px solid var(--red);
}

.input-area{
padding:10px;background:#000;border-top:1px solid #222;
display:flex;gap:10px;
}

input{
flex:1;padding:10px;border-radius:10px;
border:1px solid #333;background:#111;color:white;
}

.send-btn{
background:var(--red);color:white;border:none;
padding:10px 15px;border-radius:10px;cursor:pointer;
}
</style>
</head>

<body>

<div class="overlay" id="overlay" onclick="toggleMenu()"></div>

<nav class="sidebar" id="sidebar">
<h2 style="color:#ff4500;margin-bottom:20px;">OLD MAFIA</h2>

<div class="room-btn active" onclick="changeRoom('ğŸ’¬ áƒ–áƒáƒ’áƒáƒ“áƒ˜ áƒ©áƒáƒ¢áƒ˜', this)">ğŸ’¬ áƒ–áƒáƒ’áƒáƒ“áƒ˜ áƒ©áƒáƒ¢áƒ˜</div>
<div class="room-btn" onclick="changeRoom('ğŸ’ VIP áƒ¡áƒáƒ£áƒ‘áƒ áƒ”áƒ‘áƒ˜', this)">ğŸ’ VIP áƒ¡áƒáƒ£áƒ‘áƒ áƒ”áƒ‘áƒ˜</div>
<div class="room-btn" onclick="changeRoom('ğŸ”’ áƒ¨áƒ˜áƒ¤áƒ áƒáƒ’áƒ áƒáƒ›áƒ', this)">ğŸ”’ áƒ¨áƒ˜áƒ¤áƒ áƒáƒ’áƒ áƒáƒ›áƒ</div>
<div class="room-btn" onclick="changeRoom('ğŸ¯ áƒ•áƒ˜áƒ¥áƒ¢áƒáƒ áƒ˜áƒœáƒ', this)">ğŸ¯ áƒ•áƒ˜áƒ¥áƒ¢áƒáƒ áƒ˜áƒœáƒ</div>
<div class="room-btn" onclick="changeRoom('ğŸª¢ áƒ©áƒáƒ›áƒáƒ®áƒ áƒ©áƒáƒ‘áƒáƒœáƒ', this)">ğŸª¢ áƒ©áƒáƒ›áƒáƒ®áƒ áƒ©áƒáƒ‘áƒáƒœáƒ</div>
<div class="room-btn" onclick="changeRoom('ğŸ˜‚ áƒ˜áƒ£áƒ›áƒáƒ áƒ˜', this)">ğŸ˜‚ áƒ˜áƒ£áƒ›áƒáƒ áƒ˜</div>
<div class="room-btn" onclick="changeRoom('ğŸµ áƒ›áƒ£áƒ¡áƒ˜áƒ™áƒ', this)">ğŸµ áƒ›áƒ£áƒ¡áƒ˜áƒ™áƒ</div>
<div class="room-btn" onclick="changeRoom('ğŸ–¼ï¸ áƒ’áƒáƒšáƒ”áƒ áƒ”áƒ', this)">ğŸ–¼ï¸ áƒ’áƒáƒšáƒ”áƒ áƒ”áƒ</div>
<div class="room-btn" onclick="changeRoom('ğŸ¤ áƒ’áƒáƒªáƒœáƒáƒ‘áƒ', this)">ğŸ¤ áƒ’áƒáƒªáƒœáƒáƒ‘áƒ</div>
<div class="room-btn" onclick="changeRoom('ğŸ›¡ï¸ áƒáƒ“áƒ›áƒ˜áƒœáƒ˜áƒ¡áƒ¢áƒ áƒáƒªáƒ˜áƒ', this)">ğŸ›¡ï¸ áƒáƒ“áƒ›áƒ˜áƒœáƒ˜áƒ¡áƒ¢áƒ áƒáƒªáƒ˜áƒ</div>

</nav>

<header>
<div class="burger" onclick="toggleMenu()">â˜°</div>
<div class="room-name" id="room-title">ğŸ’¬ áƒ–áƒáƒ’áƒáƒ“áƒ˜ áƒ©áƒáƒ¢áƒ˜</div>
<img id="top-avatar" onclick="goProfile()"
src="https://i.imgur.com/6VBx3io.png">
</header>

<div id="messages"></div>

<div class="input-area">
<input type="text" id="msg-input" placeholder="áƒ“áƒáƒ¬áƒ”áƒ áƒ” áƒ¨áƒ”áƒ¢áƒ§áƒáƒ‘áƒ˜áƒœáƒ”áƒ‘áƒ...">
<button class="send-btn" onclick="send()">â¤</button>
</div>

<script>
const _sb = supabase.createClient(
"https://ftfciebnywbondaiarnc.supabase.co",
"sb_publishable_eQZDSu_Jy1gWmXJFF800Pw_TP2kBRLI"
);

const myNick = localStorage.getItem('username');
let currentRoom = 'ğŸ’¬ áƒ–áƒáƒ’áƒáƒ“áƒ˜ áƒ©áƒáƒ¢áƒ˜';

function toggleMenu(){
document.getElementById('sidebar').classList.toggle('open');
document.getElementById('overlay').style.display =
document.getElementById('sidebar').classList.contains('open')?'block':'none';
}

function changeRoom(name, el){
currentRoom = name;
document.getElementById('room-title').innerText = name;
document.querySelectorAll('.room-btn').forEach(b=>b.classList.remove('active'));
el.classList.add('active');
toggleMenu();
loadMsgs();
}

function goProfile(){
location.href='profile.html';
}

async function loadMsgs(){
const { data } = await _sb
.from('messages_v3')
.select('*')
.eq('room_name', currentRoom)
.order('created_at', {ascending:true});

const box = document.getElementById('messages');

if(data){
box.innerHTML = data.map(m=>`
<div class="bubble">
<b>${m.nickname}</b><br>${m.message}
</div>
`).join('');
box.scrollTop = box.scrollHeight;
}
}

async function send(){
const input=document.getElementById('msg-input');
const text=input.value.trim();
if(!text) return;

await _sb.from('messages_v3')
.insert([{nickname:myNick,message:text,room_name:currentRoom}]);

input.value="";
loadMsgs();
}

async function loadMyAvatar(){
const { data } = await _sb
.from('profiles')
.select('avatar_url')
.eq('username', myNick)
.single();

if(data && data.avatar_url){
document.getElementById('top-avatar').src = data.avatar_url;
}
}

window.onload=()=>{
loadMsgs();
loadMyAvatar();
setInterval(loadMsgs,3000);
};
</script>

</body>
</html>
