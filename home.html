ALTER TABLE messages_v3 ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Allow select for all"
ON messages_v3
FOR SELECT
USING (true);

CREATE POLICY "Allow insert for all"
ON messages_v3
FOR INSERT
WITH CHECK (true);

CREATE POLICY "Allow delete for admins"
ON messages_v3
FOR DELETE
USING (
  EXISTS (
    SELECT 1 FROM user_profiles
    WHERE user_profiles.nickname = messages_v3.nickname
    AND user_profiles.role IN ('admin','owner')
  )
);
